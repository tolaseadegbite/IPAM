<%= turbo_frame_tag "department_options_frame" do %>
  <% 
     target_model = params[:target_model] || "employee" 
     input_name = "#{target_model}[department_id]"
     
     # FIX: Only add Stimulus attributes if this is for a Device (to trigger Employee load).
     # For Employees, this is the end of the chain, so we don't want to trigger anything.
     html_options = {
       prompt: "Select Department",
       class: "input cursor-pointer",
       id: "#{target_model}_department_id"
     }

     if target_model == "device"
       html_options[:data] = { 
         action: "change->dependent-select#load", 
         dependent_select_target: "select" 
       }
     end
  %>
  
  <%= select_tag input_name, 
        options_from_collection_for_select(departments, :id, :name),
        html_options %>
<% end %>